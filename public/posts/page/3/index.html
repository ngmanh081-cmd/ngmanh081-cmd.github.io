<!doctype html><html lang=en dir=auto data-theme=dark><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | Network Coding Blog</title><meta name=keywords content><meta name=description content="Posts - Network Coding Blog"><meta name=author content="Me"><link rel=canonical href=http://localhost:1313/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.fd5566c526ae48aadabd950798a2dc3568536401560eae5caac3765a42a9e7b5.css integrity="sha256-/VVmxSauSKravZUHmKLcNWhTZAFWDq5cqsN2WkKp57U=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=http://localhost:1313/posts/index.xml title=rss><link rel=alternate hreflang=en href=http://localhost:1313/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script>localStorage.getItem("pref-theme")==="light"&&(document.querySelector("html").dataset.theme="light")</script><meta property="og:url" content="http://localhost:1313/posts/"><meta property="og:site_name" content="Network Coding Blog"><meta property="og:title" content="Posts"><meta property="og:description" content="Chia sẻ về Lập trình mạng, Socket, Java & Cisco"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Posts"><meta name=twitter:description content="Chia sẻ về Lập trình mạng, Socket, Java & Cisco"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Network Coding Blog (Alt + H)">Network Coding Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/posts/ title="Bài viết"><span class=active>Bài viết</span></a></li><li><a href=http://localhost:1313/search/ title="Tìm kiếm"><span>Tìm kiếm</span></a></li></ul></nav></header><main class=main><header class=page-header><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent></h2></header><div class=entry-content><p>3. File: content/posts/3-java-nio-non-blocking.md (Chủ đề: Kỹ thuật nâng cao Java NIO - Bài viết chuyên sâu)
--- title: "Java NIO: Bí mật đằng sau các High-Performance Server" date: 2025-12-23 draft: false weight: 3 tags: ["Java", "NIO", "Netty", "Architecture"] summary: "Phân tích sự khác biệt giữa Blocking IO và Non-Blocking IO. Tại sao Node.js hay Netty lại nhanh đến vậy?" --- Nếu bạn thắc mắc tại sao **Node.js** (đơn luồng) lại có thể xử lý hàng chục nghìn kết nối đồng thời, hay tại sao các framework Java hiện đại như **Netty**, **Vert.x** lại có hiệu năng vượt trội so với Tomcat truyền thống, thì câu trả lời nằm ở: **Non-blocking I/O (NIO)**. Trong Java, gói thư viện này nằm ở `java.nio` (được giới thiệu từ Java 1.4). ## 1. IO Truyền thống (BIO) vs NIO ### BIO (Blocking I/O) - Mô hình cũ Như các bài trước, BIO dựa trên **Stream** (Luồng dữ liệu). * Khi gọi `input.read()`, Thread bị chặn (block) cho đến khi có dữ liệu. * **Hệ quả:** Cần 1 Thread cho mỗi kết nối. 10k kết nối = 10k Threads. Rất tốn kém. ### NIO (Non-blocking I/O) - Mô hình mới NIO dựa trên **Buffer** (Vùng nhớ) và **Channel** (Kênh). * Khi gọi đọc dữ liệu, nếu chưa có dữ liệu, nó trả về ngay lập tức thay vì bắt chờ đợi. Thread đó có thể đi làm việc khác. * **Hệ quả:** Chỉ cần **1 Thread duy nhất** có thể quản lý 10k kết nối. ## 2. Ba trụ cột của Java NIO Để hiểu NIO, bạn cần nắm 3 khái niệm: 1. **Buffer:** Là một vùng nhớ (block of memory) để chứa dữ liệu đọc/ghi. Trong NIO, bạn luôn đọc từ Channel vào Buffer, hoặc ghi từ Buffer ra Channel. 2. **Channel:** Giống như Socket nhưng là đường 2 chiều (có thể vừa đọc vừa ghi). Quan trọng nhất là nó hỗ trợ chế độ phi đồng bộ (asynchronous). 3. **Selector (Bộ chọn):** Đây là "nhạc trưởng". Một Selector có thể giám sát hàng trăm Channel. Khi nào Channel nào có dữ liệu ("Hey, tôi có tin nhắn mới!"), Selector sẽ báo cho Thread xử lý. ## 3. Code ví dụ: NIO Echo Server Code NIO phức tạp hơn BIO rất nhiều, nhưng "đắt xắt ra miếng". ```java import java.io.IOException; import java.net.InetSocketAddress; import java.nio.ByteBuffer; import java.nio.channels.*; import java.util.Iterator; import java.util.Set; public class NioServer { public static void main(String[] args) throws IOException { // 1. Mở Selector Selector selector = Selector.open(); // 2. Mở ServerSocketChannel (thay vì ServerSocket thường) ServerSocketChannel serverSocket = ServerSocketChannel.open(); serverSocket.bind(new InetSocketAddress("localhost", 6666)); // QUAN TRỌNG: Cấu hình chế độ Non-blocking serverSocket.configureBlocking(false); // 3. Đăng ký kênh server với Selector, lắng nghe sự kiện ACCEPT (kết nối mới) serverSocket.register(selector, SelectionKey.OP_ACCEPT); System.out.println("NIO Server đang chạy..."); while (true) { // Chờ cho đến khi có ít nhất 1 sự kiện xảy ra selector.select(); // Lấy danh sách các kênh đang kích hoạt (có sự kiện) Set&lt;SelectionKey> selectedKeys = selector.selectedKeys(); Iterator&lt;SelectionKey> iter = selectedKeys.iterator(); while (iter.hasNext()) { SelectionKey key = iter.next(); if (key.isAcceptable()) { // Sự kiện: Có client mới kết nối register(selector, serverSocket); } if (key.isReadable()) { // Sự kiện: Có dữ liệu gửi đến để đọc answerWithEcho(key); } // Xử lý xong thì xóa key khỏi danh sách để tránh lặp lại iter.remove(); } } } private static void register(Selector selector, ServerSocketChannel serverSocket) throws IOException { SocketChannel client = serverSocket.accept(); client.configureBlocking(false); // Client này cũng phải Non-blocking client.register(selector, SelectionKey.OP_READ); // Chỉ quan tâm khi nào nó gửi tin nhắn System.out.println("Client mới kết nối: " + client.getRemoteAddress()); } private static void answerWithEcho(SelectionKey key) throws IOException { SocketChannel client = (SocketChannel) key.channel(); ByteBuffer buffer = ByteBuffer.allocate(256); // Tạo vùng đệm 256 bytes int r = client.read(buffer); if (r == -1) { client.close(); // Client đã ngắt kết nối System.out.println("Client ngắt kết nối."); } else { // Chuyển chế độ Buffer từ ghi sang đọc buffer.flip(); // Ghi dữ liệu từ Buffer trả ngược lại Client (Echo) client.write(buffer); buffer.clear(); } } }</p></div><footer class=entry-footer><span>Me</span></footer><a class=entry-link aria-label="post link to " href=http://localhost:1313/posts/3-java-nio-non-blocking/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=http://localhost:1313/posts/page/2/>«&nbsp;Prev&nbsp;</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Network Coding Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>